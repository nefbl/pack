#!/usr/bin/env node

'use strict';

process.title = 'nefbl-builder';

const fs = require('fs');
const nodejs = require('@hai2007/nodejs');

// 首先，获取配置文件
let config = require('./config')(process);

// 获取基础文件
let scriptContent = fs.readFileSync(nodejs.fullPath('./script.js', __dirname), 'utf-8');

// 从入口文件开始，进行模块分析
let evalContent = require('./modules/analyseBundle')(config.entry.file, config);

// 写入入口文件
fs.writeFileSync(config.output.file, "(function(window,undefined){\n" + scriptContent + "\n\n" + evalContent + "\n})(window);");
